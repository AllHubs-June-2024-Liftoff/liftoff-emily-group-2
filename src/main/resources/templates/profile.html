<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org/">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Park'd Profile</title>
    <link th:href="@{/css/styles.css}" rel="stylesheet" />

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const followButton = document.getElementById('followButton');
            if (followButton) {
                followButton.addEventListener('click', function() {
                    const container = followButton.parentElement;
                    const isFollowing = container.dataset.isFollowing === 'true';
                    const username = container.dataset.username;
                    const action = isFollowing ? "unfollow" : "follow";

                    fetch(`/follow/${action}/${username}`, {
                        method: 'POST'
                    })
                    .then(response => {
                        if (!response.ok) {
                            return Promise.reject('Network response was not ok');
                        }
                        return response; 
                    })
                    .then(() => {
                        followButton.textContent = isFollowing ? 'Follow' : 'Unfollow';
                        container.dataset.isFollowing = String(!isFollowing);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert("An error occurred. Please try again.");
                    });
                });
            }
        });
    </script>
</head>
<body>
<header>
    <div class="profile">
        <img src="profile-placeholder.png" alt="Profile Picture">
        <div class="dropdown">
            <div class="dropdown-header">
                <img src="profile-placeholder.png" alt="Profile Picture">
                <div>
                    <h4 th:text="${user}" >John Doe</h4>
                    <p>Parks Enthusiast</p>
                   <!--<div th:if="${user != #authentication.name}"
                    th:attr="data-is-following=${isFollowing}, data-username=${user}">
                   <button id="followButton" th:if="${not isFollowing}" th:inline="text">Follow</button>
                   <button id="followButton" th:if="${isFollowing}" th:inline="text">Unfollow</button>
               </div>-->
               <div th:if="${showFollowButton}"  th:attr="data-is-following=${isFollowing}, data-username=${user}">
                <button id="followButton" th:if="${not isFollowing}" th:inline="text">Follow</button>
                <button id="followButton" th:if="${isFollowing}" th:inline="text">Unfollow</button>
            </div>
                </div>
            </div>
            <a th:href="@{/}">Home Page</a>
            <a href="#">Settings</a>
            <a th:href="@{/logout}">Logout</a>
        </div>
    </div>
</header>

<div class="profile-container">
    <div class="profile-header">
        <img src="profile-placeholder.png" alt="Profile Picture">
        <div class="profile-info">
            <h1 th:text="${user}" >John Doe</h1>
            <p>Parks Enthusiast</p>
        </div>
    </div>

    <div class="stats">
        <div class="stat">
            <h2>12</h2>
            <p>Parks</p>
        </div>
        <div class="stat">
            <h2>10</h2>
            <p>Badges</p>
        </div>
        <div class="stat">
            <h2>5</h2>
            <p>Reviews</p>
        </div>
        <div class="stat">
            <h2>2</h2>
            <p>Followers</p>
        </div>
    </div>

    <div class="badges">
        <h2>Achievements</h2>
        <div class="badge-grid">
            <div class="badge">
                <img src="badge-placeholder.png" alt="Badge">
                <p>Beginner</p>
            </div>
            <div class="badge">
                <img src="badge-placeholder.png" alt="Badge">
                <p>Adventurer</p>
            </div>
        </div>
    </div>
</div>
<footer>
    &copy; 2025 Park'd. All rights reserved.
</footer>
</body>
</html>
